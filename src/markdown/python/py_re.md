# Регулярные выражения в Python

**Регулярные выражения (RegExp, regex)** — мощный инструмент для поиска, проверки, замены и извлечения данных из строк по заданному шаблону. Позволяют гибко обрабатывать текст: валидировать форматы (email, номер телефона), извлекать группы, массово заменять подстроки и многое другое.

В Python для работы с регулярными выражениями используется стандартный модуль `re`.

---

## Основные понятия

- **Шаблон (pattern)** — строка со спецсимволами, описывающая правила поиска.
- **Сырые строки (r"…")** — почти всегда рекомендуется использовать для регулярных выражений, чтобы спецсимволы не экранировались Python-строкой.
- **Группы (groups)** — части выражения, взятые в скобки `()`, которые можно потом извлечь отдельно.

---

## Ключевые символы и конструкции

| Конструкция   | Значение                           | Пример               |
| ------------- | ---------------------------------- | -------------------- | ---- | ---- |
| `.`           | любой символ, кроме \n             | `a.b` → "acb", "a-b" |
| `\d`          | цифра                              | `\d+` → "123"        |
| `\w`          | буква, цифра или \_                | `\w+` → "abc_42"     |
| `\s`          | пробельный символ                  | `\s+` → " "          |
| `^`, `$`      | начало и конец строки              | `^abc$`              |
| `[]`          | класс символов (один из...)        | `[A-Za-z0-9]`        |
| `[^...]`      | отрицание внутри класса            | `[^0-9]`             |
| `a            | b`                                 | или                  | `cat | dog` |
| `()`          | группа                             | `(\d+)-(\d+)`        |
| `?`, `*`, `+` | кванторы: 0 или 1, 0 или более, 1+ | `ab*` → "a", "abbb"  |

---

## Базовые операции

### 1. Поиск совпадений (`re.search`, `re.match`, `re.fullmatch`)

```python
import re

text = "Телефон: +7-921-555-12-34"
match = re.search(r"\+7-\d{3}-\d{3}-\d{2}-\d{2}", text)
if match:
    print(match.group())
# +7-921-555-12-34

# re.match ищет только в начале строки
result = re.match(r"\d+", "123abc")
print(result.group())  # 123

# re.fullmatch проверяет, что вся строка соответствует шаблону
print(re.fullmatch(r"\d+", "123abc"))  # None
print(re.fullmatch(r"\d+", "123"))     # <re.Match object ...>
```

---

### 2. Поиск всех совпадений (`re.findall`, `re.finditer`)

```python
text = "abc123xyz456abc789"
numbers = re.findall(r"\d+", text)
print(numbers)
# ['123', '456', '789']

# Итератор совпадений:
for m in re.finditer(r"[a-z]+", text):
    print(m.group())
# abc
# xyz
# abc
```

---

### 3. Замена подстрок (`re.sub`, `re.subn`)

```python
text = "foo bar baz"
print(re.sub(r"ba.", "XX", text))
# foo XX XX

# Счётчик замен:
print(re.subn(r"ba.", "YY", text))
# ('foo YY YY', 2)
```

---

### 4. Разделение строки по шаблону (`re.split`)

```python
text = "12, 34; 56:78"
print(re.split(r"[,;:]\s*", text))
# ['12', '34', '56', '78']
```

---

### 5. Валидация данных (проверка формата)

**Пример: проверка email**

```python
email = "test.user@example.com"
is_valid = re.fullmatch(r"[\w\.-]+@[\w\.-]+\.\w+", email)
print(bool(is_valid))
# True
```

**Пример: проверка российского номера телефона**

```python
phone = "+7 (911) 555-44-33"
is_valid = re.fullmatch(r"\+7\s?\(?\d{3}\)?[\s-]?\d{3}[\s-]?\d{2}[\s-]?\d{2}", phone)
print(bool(is_valid))
# True
```

---

## Группы и извлечение подстрок

```python
text = "Name: Alice, Age: 25"
m = re.search(r"Name: (\w+), Age: (\d+)", text)
if m:
    print(m.group(1))  # Alice
    print(m.group(2))  # 25
    print(m.groups())  # ('Alice', '25')
```

**Именованные группы:**

```python
m = re.search(r"(?P<name>\w+): (?P<val>\d+)", "height: 180")
print(m.group("name"))  # height
print(m.group("val"))   # 180
```

---

## Флаги

- `re.IGNORECASE` (`re.I`) — игнорировать регистр
- `re.MULTILINE` (`re.M`) — ^ и $ работают для каждой строки
- `re.DOTALL` (`re.S`) — . захватывает \n

```python
re.findall(r"abc", "ABC", re.IGNORECASE)
# ['ABC']
```

---

## Нюансы, подводные камни и типичные ошибки

- `re.match` работает только с начала строки. Для поиска по всей строке используйте `re.search`.
- Не забывайте использовать **сырые строки** (r"…"), иначе могут возникнуть ошибки экранирования.
- Жадность кванторов: по умолчанию кванторы захватывают максимальное возможное количество символов (`.*`). Для “ленивого” режима используйте `*?`, `+?`, `??`.
- Если результат не найден, возвращается `None` — не вызывайте `.group()`, не проверив результат.

---

## Сложные примеры и полезные трюки

**Извлечь все даты формата ДД.ММ.ГГГГ:**

```python
text = "Сегодня 01.06.2025, завтра 02.06.2025."
dates = re.findall(r"\d{2}\.\d{2}\.\d{4}", text)
print(dates)
# ['01.06.2025', '02.06.2025']
```

**Удалить все HTML-теги из строки:**

```python
html = "<p>Привет <b>мир</b></p>"
clean = re.sub(r"<.*?>", "", html)
print(clean)
# Привет мир
```

**Вставить запятые в большие числа:**

```python
num = "1234567890"
res = re.sub(r"(?<=\d)(?=(\d{3})+$)", ",", num)
print(res)
# 1,234,567,890
```

---

## Быстрая шпаргалка

- Проверка формата: `re.fullmatch(pattern, s)`
- Поиск одного совпадения: `re.search(pattern, s)`
- Поиск всех совпадений: `re.findall(pattern, s)`
- Итератор совпадений: `re.finditer(pattern, s)`
- Замена: `re.sub(pattern, repl, s)`
- Разделение строки: `re.split(pattern, s)`

---

## Ссылки на документацию и полезные ресурсы

- [Документация Python: re — Regular expression operations](https://docs.python.org/3/library/re.html)
- [RegExr — интерактивный справочник по регуляркам (англ.)](https://regexr.com/)
- [Тестирование регулярных выражений онлайн (рус.)](https://regex101.com/)
- [Python Regular Expressions HOWTO](https://docs.python.org/3/howto/regex.html)

# Интернационализация и локализация в Python

**Интернационализация (i18n)** — процесс подготовки программы к переводу на разные языки и адаптации к локальным стандартам.  
**Локализация (l10n)** — конкретный перевод текста, адаптация форматов дат, чисел, валют и других особенностей под конкретную культуру или регион.

---

## Основные понятия

- **i18n** (Internationalization) — “международность”, включает подготовку кода, структуры каталогов, механизмов подстановки перевода, абстрагирование дат, чисел, форматов.
- **l10n** (Localization) — “локализация”, это сами переводы и настройка под региональные стандарты (язык, форматы, алфавит, валюта).
- **gettext** — стандартная система для организации переводов в Python и большинстве других языков.
- **po, mo файлы** — форматы хранения переводов (po — текстовые, mo — бинарные, используются в runtime).

---

## Стандартная библиотека: gettext

- Основной инструмент для перевода сообщений в Python — модуль `gettext`.
- Используется также в Django, Flask, многих CLI-утилитах.

**Пример использования:**

```python
import gettext
# Генерация "фейкового" перевода для примера
ru = gettext.translation('base', localedir='locales', languages=['ru'], fallback=True)
ru.install()
_ = ru.gettext

print(_("Hello, world!"))
# "Привет, мир!" (если есть перевод в файлах locales/ru/LC_MESSAGES/base.mo)
```

- Для строк, которые нужно переводить, используют функцию \_(…) или gettext(…).

---

### Как устроен процесс i18n + l10n (на примере gettext)

1. **Разметить строки в коде для перевода**:
   ```python
   from gettext import gettext as _
   print(_("Hello, user!"))
   ```
2. **Сгенерировать .pot-файл (шаблон переводов)**:
   - Обычно делается через специальные инструменты, например, xgettext или pygettext.
3. **Создать po-файлы для нужных языков**:
   - Файл locales/ru/LC_MESSAGES/base.po для русского, en/… для английского и т.д.
4. **Перевести строки в po-файлах**.
5. **Скомпилировать po → mo**:
   - `msgfmt base.po -o base.mo`
6. **Подключить переводы в программе** через `gettext.translation`.

---

## Интернационализация дат, времени, чисел

Для корректного отображения форматов дат, чисел, валют используют модуль **locale**:

```python
import locale
locale.setlocale(locale.LC_ALL, "ru_RU.UTF-8")
from datetime import datetime

now = datetime.now()
print(now.strftime("%c"))
# В России: 'Пн 10 июн 2024 13:20:10'
```

---

## Django: i18n и l10n “из коробки”

- Django имеет встроенные инструменты для перевода сайтов и приложений:
  - Механизм шаблонов
  - Команды manage.py: `makemessages`, `compilemessages`
  - Автоматический выбор локали по языку браузера пользователя

---

## Flask и другие фреймворки

- Flask поддерживает плагины типа Flask-Babel для перевода текста, дат, чисел.

**Пример:**

```python
from flask_babel import Babel, _

app = Flask(__name__)
babel = Babel(app)

@app.route("/")
def index():
    return _("Welcome!")
```

---

## Интересные детали и фишки

- Для перевода внутри строк (f-строки) используйте шаблоны: `_('Your balance: %(bal)d', bal=100)`.
- Можно локализовать не только текст, но и изображения, цвета, звуки.
- Библиотека babel (pip install babel) — поддержка форматирования дат, валют, чисел по локали.
- Используйте уникальные msgid — проще поддерживать переводы.
- В Python 3 строки для перевода должны быть в Unicode (str).

---

## Типичные ошибки и подводные камни

- Переводы не сработают без компиляции .po → .mo.
- Некорректные настройки локали на сервере — не работают форматы чисел, дат.
- Неиспользование специальных функций \_(…) или gettext(…) — строки не попадут в po-файл.
- Переменные в переводимых строках должны быть явными (`%(name)s`), иначе переводы будут неверными.
- Дата и валюта без локализации — потеря доверия пользователей.

---

## Ссылки на документацию и полезные ресурсы

- [gettext — документация](https://docs.python.org/3/library/gettext.html)
- [Django: интернационализация и локализация](https://docs.djangoproject.com/en/4.0/topics/i18n/)
- [Flask-Babel](https://pythonhosted.org/Flask-Babel/)
- [Babel — даты, числа, валюты](https://babel.pocoo.org/en/latest/index.html)
- [Введение в интернационализацию Python (Хабр)](https://habr.com/ru/post/118928/)

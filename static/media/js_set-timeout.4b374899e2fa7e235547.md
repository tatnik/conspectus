# Планирование: setTimeout и setInterval

## SetTimeout

_SetTimeout_ - это API предоставляемое в соответствии со [спецификацией HTML5](https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html), и это API никакого отношения к JavaScript не имеет

_setTimeout_ обычно используется в сценариях, где требуется :

- ввести задержки,

- запланировать события

- выполнять задачи через определенные промежутки времени

### Cинтаксис:

```javascript
setTimeout(function|code, [delay], [param1, param2, ...]);
```

function - функция, которая будет вызвана с задержкой
delay - задержка в милисекундах
param1, param2, ... - параметры, которые будут переданы функции (опционально)

возвращает идентификатор таймера

Если задержка не указана, function будет вызываться настолько быстро, насколько это возможно. Но планировщик будет вызывать функцию только после завершения выполнения текущего кода.

### Примеры использования:

- с передачей функции параметра:

```javascript
function greet(name) {
  console.log('Hello, ' + name + '!');
}

setTimeout(greet, 5000, 'John');
```

- с анонимной функцией:

```javascript
setTimeout(function () {
  console.log('This code executes after the delay');
}, 1000);
```

- с литералом (не рекомендуется, нет гарантии, что используемые переменные будут доступны):

```javascript
setTimeout("console.log('Hello World!');", 500);
```

- со стрелочной функцией:

```javascript
setTimeout(() => {
  console.log('Hello World!');
}, 500);
```

[Подробнее...](https://robiul.dev/javascript-settimeout-method-all-you-need-to-know)

### Периодический запуск функций

#### с использованием функции **setInterval**

```javascript
let timerId = setInterval(func|code, [delay], [arg1], [arg2], ...);
```

функция запускается периодически через указанный интервал времени.

```javascript
let i = 1;
setInterval(function () {
  func(i);
}, 100);
```

![set-interval](/conspectus/jpg/set-interval.jpg)

#### с использованием вложенного **setTimeout**

```javascript
let i = 1;
setTimeout(function run() {
  func(i);
  setTimeout(run, 100);
}, 100);
```

![set-timeout](/conspectus/jpg/set-timeout.jpg)

все методы планирования не гарантируют точную задержку.

Например, таймер в браузере может замедляться по многим причинам:

- Перегружен процессор.
- Вкладка браузера в фоновом режиме.
- Работа ноутбука от аккумулятора.

Всё это может увеличивать минимальный интервал срабатывания таймера (и минимальную задержку) до 300 или даже 1000 мс в зависимости от браузера и настроек производительности ОС.

### Отмена

Для отмены выполнения необходимо вызвать **clearInterval / clearTimeout** со значением, которое возвращают методы _setInterval / setTimeout_.

функция, используемая в **setTimeout** остаётся в памяти до тех пор, пока планировщик обращается к ней.

функция, используемая в **setInterval** остаётся в памяти до тех пор, пока не будет вызван **clearInterval**

Используемая функция ссылается на внешнее лексическое окружение, поэтому пока она существует, внешние переменные существуют тоже. Они могут занимать больше памяти, чем сама функция. Поэтому желательно явно отменять _setInterval / setTimeout_.

```javascript
let timerId = setTimeout(...);
clearTimeout(timerId);
```

### Минимальная задержка вложенных таймеров в браузере

В браузере есть ограничение на то, как часто внутренние счётчики могут выполняться. В стандарте HTML5 говорится: **после пяти вложенных таймеров интервал должен составлять не менее четырёх миллисекунд**. Для setInterval - аналогично, начиная с 5-го вызова.

Этого ограничения нет в серверном JavaScript
